<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>{Title}</title>
  <link rel="shortcut icon" href="{Favicon}">
  <link rel="alternate" type="application/rss+xml" href="{RSS}">
  {block:Description}
    <meta name="description" content="{MetaDescription}" />
  {/block:Description}
  <link rel="stylesheet" href="http://twitter.github.com/bootstrap/1.4.0/bootstrap.min.css" />
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script>
(function(){

function summary(str, max) {
  var result = str;
  var resultArray = result.split(" ");
  if(resultArray.length > max){
    resultArray = resultArray.slice(0, max);
    result = resultArray.join(" ") + "...";
  }
  return result;
}
// takes care of parsing the body str html
function BodyParser($body) {
  this.$body = $body;
}
BodyParser.prototype.getFirstImage = function() {
  var res = this.$body.find("img");
  return res.eq(0).attr("src");
};
BodyParser.prototype.getSubtitle = function() {
  var firstP = this.$body.find("p").eq(0);
  var res = firstP.text();
  if(!res) {
    res = this.$body.text();
  }
  return summary($.trim(res), 18);
}
BodyParser.prototype.getSummary = function() {
  // loop through all the p's and find the first one
  // that has text except the first one
  var found = false;
  var pbody = this.$body.find("p");
  pbody.each(function(idx){
    var $this = $(this),
        text = $.trim($this.text());
    if(!found && idx > 0 && text !== "") {
      found = text;
    }
  });
  if(!found) { // ok then get the first p
    var firstP = pbody.eq(0);
    var found = firstP.text();
    if(!found) {
      found = this.$body.text();
    }
  }
  return summary($.trim(found), 80);
}

function addFirst(data) {
  // imgSrc, permalink, title, subtitle, body, date
  var $first = $($("#first-post").html());
  $first.find("span.thumb").attr("style", "background-image:url("+data.imgSrc+")");
  $first.find("a:first").attr("href", data.permalink);
  $first.find("span.title").text(data.title);
  $first.find("small.subtitle").text(data.subtitle);
  $first.find("span.prose").text(data.body);
  $first.find("small.date").text(data.date);
  $("ul.heroes").append($first);
}
function addOther($parent, data) {
  // imgSrc, permalink, title, body, date
  var $other = $($("#other-post").html());
  $other.find("span.thumb").attr("style", "background-image:url("+data.imgSrc+")");
  $other.find("a:first").attr("href", data.permalink);
  $other.find("span.title").text(data.title);
  $other.find("small.subtitle").text(data.subtitle);
  $other.find("small.date").text(data.date);
  $parent.append($other);
}
function getData($post) {
    var ret = {};
    var parser = new BodyParser($post.find(".tumblr-body"));
    ret.imgSrc = parser.getFirstImage();
    if(!ret.imgSrc) { // if no image is found look directly inside the $post for it
      ret.imgSrc = $post.find("img").eq(0).attr("src");
    }
    ret.permalink = $post.find(".tumblr-permalink").text();
    ret.title = $post.find(".tumblr-title").text();
    ret.subtitle = parser.getSubtitle();
    ret.body = parser.getSummary();
    ret.date = $post.find(".tumblr-date").text();

    return ret;
}
function showPost($domPost, idx) {
  // based on the className, get the data for this post
  var data = getData($domPost);
  if(idx === 0) {
    addFirst(data);
  } else {
    addOther($("ul.heroes"), data);
  }
}

function showIndex() {
  var $tumblrData = $("#tumblr-data");
  // get first 4 posts from tumblr-data
  var $children = $tumblrData.children();
  for(var i=0; i<$children.length; i++) {
    if(i > 3) break;
    var $domPost = $children.eq(i);
    if($domPost) {
      showPost($domPost, i);
    }
  }
  var $heroes = $("div.heroes");
  $("#all-posts").click(function(e) {
    showAll();
    e.preventDefault();
    e.stopPropagation();
  });
  $heroes.fadeIn("slow");
}
function showAll() {
  var $tumblrData = $("#tumblr-data");
  var $children = $tumblrData.children();
  var $postgrid = $(".postgrid");
  for(var i=0; i<$children.length; i++) {
    var $domPost = $children.eq(i);
    if($domPost) {
      var data = getData($domPost);
      addOther($postgrid, data);
    }
  }
  var $heroes = $("div.heroes");
  $heroes.fadeOut("slow", function() {
    $postgrid.fadeIn("slow");
  });
}

$(function(){
{block:IndexPage}
  showIndex();
{/block:IndexPage}
{block:PermalinkPage}
  $("#tumblr-data").show();
{/block:PermalinkPage}
});
})();
</script>
<style>
html {
    background-color: #F4F4F4 !important;
    overflow-y: auto !important;
}
body {
  background-color: #F4F4F4 !important;
  color: #333333;
  font-family: 'Helvetica Neue',Helvetica,Arial,'Lucida Grande',sans-serif;
  font-size: 15px;
  font-weight: 200;
  margin: 0 auto;
  padding: 0;
}
body p {
    font-size: 15px;
    line-height: 150%;
}
a {
  color: #3E90C6;
  text-decoration: underline;
  transition: .2s ease;
  -webkit-transition: .2s ease;
  -moz-transition: .2s ease;
  -o-transition: .2s ease;
}
a.btn {
    text-decoration: none !important;
}
img {
    border-style: none;
}
iframe {
  display:none;
}
.span16 {
  overflow:hidden;
}
.content {
  overflow: hidden;
  display: inline;
  float: left;
  margin: 0;
  padding: 0;
}
.content h1 {
    color: #383D44;
    font-size: 30px;
    font-weight: 700;
    margin: 0 0 10px;
    padding: 5px 0;
}
.content p {
  line-height: 150%;
  /*
  margin: 0;
  padding: 0;
  */
}
.content h1 a, .content h1 a:visited {
  color: #383D44;
  text-decoration: none;
}
h1.big {
    font-size: 42px;
    margin-bottom: 5px;
    padding-top: 0;
}
#header {
  background-color: #FAFAFA;
  height: 90px;
  margin: 0 auto;
  width: 100%;
}
.headerleft {
    float: left;
    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
    font-style: italic;
    font-weight: 600;
    margin: 35px 0 0;
    padding: 0;
}
.headerleft a, .headerleft a:visited {
    color: #383D44;
    float: left;
    font-style: normal;
    margin: 0;
    padding:0;
    text-decoration: none;
    text-transform: uppercase;
    font-weight: normal;
    letter-spacing: 0.9px;
    font-weight: 300;
}
.headerright {
    font-weight: 400;
    margin-top: 30px;
    text-transform: uppercase;
}
.headerright ul {
    float: right;
    padding: 0;
}
.headerright ul li a {
    text-decoration: none;
}
.headerright ul li a img {
    height: 20px;
    padding: 5px;
    width: 20px;
}
.pills {
    margin-bottom: 5px;
}
.pills a {
    color: #333333;
    font-size: 14px;
}
.pills li a:hover {
  background: #DDD;
  color: #333!important;
  text-decoration: none!important;
  text-shadow: 0 1px 1px white;
  transition: 1s ease;
  -webkit-transition: 1s ease;
  -moz-transition: 1s ease;
  -o-transition: 1s ease;
}
.content_bg {
    background: url("https://github.com/lmatteis/grinfo-tumblr/raw/master/images/page_top_bg.png") no-repeat scroll 50% 100% #F4F4F4;
    float: left;
    height: 20px;
    margin-bottom: 10px;
    width: 100%;
    z-index: 50;
}
.sidebar {
    display: inline;
    float: right;
    font-size: 14px;
    margin: 0;
    padding: 0 0 20px 20px;
}
.sidebar ul {
    list-style: none outside none;
    margin: 0;
    padding: 0;
}
.sidebar ul li {
    display: block;
    margin-bottom: 1px;
    margin-top: 1px;
    padding: 0;
}
.sidebar ul li:first-child h2, #services {
    margin-top: 0;
}
.sidebar h2 {
    color: #383D44;
    font-size: 18px;
    font-weight: 700;
    margin: 30px 0 0;
    padding: 0;
}
.sidebar p {
    margin: 0;
    padding: 5px 0 0;
}
.sidebar ul li a, .sidebar ul li a:visited {
    color: #383D44;
    display: inline-block;
    line-height: 18px;
    margin-bottom: 5px;
    padding-left: 20px;
    text-decoration: none;
}
#footerwrap {
    border-top: 1px solid #E0E1E4;
    padding-top: 20px;
    text-align: center;
}
#footer {
    color: #404040;
    line-height: 17px;
    margin: 0 auto 10px;
    padding: 5px 0;
    text-align: right;
}
#footer p {
    color: #404040;
    font-size: 14px;
    margin: 0;
    padding: 0;
}
div.bioinfo {
    text-align: left;
    background-attachment: scroll;
    background-clip: border-box;
    background-color: transparent;
    background-image: url("https://github.com/lmatteis/grinfo-tumblr/raw/master/images/bioversity_logo.png");
    background-origin: padding-box;
    background-position: left center;
    background-repeat: no-repeat;
    background-size: auto 4em;
    float: left;
    margin-bottom: 2em;
    margin-top: -2em;
    padding-left: 5em;
    width: 300px;
}
div.bioinfo dl {
    font-size: 0.85em;
    position: relative;
    top: 0.6em;
}
div.bioinfo dt:after {
    content: ":";
    display: inline-block;
    padding-right: 0.3em;
}
div.bioinfo dt {
    float: left;
}


/** homepage blogs **/
.clearfix:after {
    clear: both;
    content: ".";
    display: block;
    height: 0;
    visibility: hidden;
}
ul.heroes {
    height: 600px;
    margin: 0 -20px;
    padding: 0 0 0 576px;
    position: relative;
}
ul.heroes a, .postgrid a {
  text-decoration: none;
}
.clearfix {
    display: block;
}
.heroes li {
  list-style: none;
}
.heroes li.hero {
    border: 0 none;
    left: 0;
    padding: 0;
    position: absolute;
    width: 576px;
}
.heroes li a {
    display: block;
    min-height: 150px;
    padding: 0 20px 10px;
    color: #333333;
}
.heroes li a:hover span.title,
.postgrid li a:hover span.title
{
  color: #00438a;
}
.heroes li.hero .thumb {
    height: 320px;
    margin: 0 0 10px;
    width: 536px;
}
.heroes li .thumb {
    box-shadow: 0 0 40px rgba(0, 0, 0, 0.25) inset;
    height: 120px;
    margin: 0 0 10px;
}
.thumb {
    background: none no-repeat scroll 50% 50% #FFFFFF;
    display: block;
    overflow: hidden;
    text-indent: -999px;
}
.heroes .hero .title {
    font-size: 28px;
    line-height: 30px;
    margin: 0 0 10px;
}
.heroes .hero .subtitle {
    color: #888888;
    font-size: 18px;
    line-height: 20px;
    margin: 0 0 20px;
}
.heroes .hero .title, .heroes .hero .subtitle {
    display: block;
    max-width: 85%;
    overflow: visible;
    white-space: normal;
}
.heroes li .title, .heroes li small {
    display: block;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
small.date {
    font-size: 10px;
    text-align: right;
    text-transform: uppercase;
}
small {
    color: #888888;
    display: block;
    font-size: 12px;
    font-weight: 300;
    line-height: 150%;
}
.heroes span {
line-height: 150%;
}
.more {
    margin: 20px 0;
    text-align: right;
}
.postgrid {
  margin: 0px -20px;
  /*background: url(images/dots-3.png) 50% 0% repeat-y;*/
}
.postgrid li {
  float: left;
  width: 244px;
  height: 300px;
  list-style: none;
  border-right: 1px dotted #CCC;
}
.postgrid a {
  position: relative;
  padding: 17px 20px 20px;
  border-top: 3px solid #CCC;
  width: 204px;
  height: 260px;
  float: left;
  overflow: hidden;
  color: #333;
}
.postgrid .thumb {
  width: 205px;
  height: 100px;
  margin: 0px 0px 10px;
  box-shadow: inset rgba(0,0,0,.25) 0px 0px 40px;
  -moz-box-shadow: inset rgba(0,0,0,.25) 0px 0px 40px;
  -webkit-box-shadow: inset rgba(0,0,0,.25) 0px 0px 40px;
}
.postgrid .title, .postgrid .date {
  display: block;
}
.postgrid .date {
  position: absolute;
  right: 20px;
  bottom: 10px;
}
.postgrid .title, .postgrid .date {
display: block;
}

</style>
</head>
<!-- templates -->
<script id="first-post" type="text/html">
  <li class="hero top">
    <a href="{Permalink}">
      <span style="background-image:url({PhotoURL-HighRes})" class="thumb"></span>
      <span class="title">{Title}</span>
      <small class="subtitle">{Title}</small>
      <span markdown="1" class="prose">{Body}</span>
      <small class="date">{ShortMonth} {DayOfMonth} {Year}</small>
    </a>
  </li>
</script>
<script id="other-post" type="text/html">
  <li>
    <a href="{Permalink}">
    
    <span style="background-image:url({PhotoURL-HighRes})" class="thumb"></span>
    
    <span class="title">{PhotoAlt}</span>
    <small class="subtitle">{PhotoAlt}</small>
    <small class="date">{ShortMonth} {DayOfMonth} {Year}</small>
    </a>
  </li>
</script>
<!-- /templates -->
<body>
  <div id="header">
    <div class="container">
      <div class="row">
        <div class="span5">
          <div class="headerleft">
            <a href="/"><b>Agrobiodiversity</b><br /> Informatics</a>
          </div>
        </div>
        <div class="span11 headerright">
          <ul class="pills">
            <li class=""><a href="/"><img width="24" height="24" alt="" src="https://github.com/lmatteis/grinfo-tumblr/raw/master/images/home_32.png" class=""></a></li>
            <li class="page_item page-item-2"><a href="#">About</a></li>
            <li class="page_item page-item-1158"><a href="#">Projects</a></li>
            <li class="page_item page-item-319"><a href="#">Blog</a></li>
            <li class="page_item page-item-11 current_page_item"><a href="#">Contact</a></li>
      
              <li>
               <a href="#" rel="alternate" class="rss" style="color: #C66809">Feed</a>
              </li>
          </ul>
        </div>
      </div>
    </div>
  </div><!-- /header -->
  <div class="container">
    <div class="row">
      <div class="span16">
        <div class="content_bg"></div>
      </div>
    </div>
  </div><!-- /empty fontainer -->
  <div class="container">
    <div class="row">
{block:IndexPage}
<div class="span16">
  <div class="heroes clearfix" style="display:none;"><!-- index -->
    <ul class="heroes clearfix">
    </ul>
    <div class="more">
      <a href="#" id="all-posts" class="btn large info">All posts &rarr;</a>
    </div>
  </div><!-- /index -->
  <ul class="postgrid clearfix" style="display:none;"><!-- all-posts -->
  </ul><!-- /all-posts -->
</div>
{/block:IndexPage}
  <!-- data from tumblr which is hidden and displayed with JavaScript. Displaying HTML to allow SEO to crawl and get data -->
  <div id="tumblr-data" class="span11 content" style="display: none;">
            {block:Posts}
                {block:Text}
                    <span class="text">
                        {block:Title}
                            <h1><a class="tumblr-title" href="{Permalink}">{Title}</a></h1>
                            <span style="display: none;" class="tumblr-permalink">{Permalink}</span>
                        {/block:Title}

                        <span class="tumblr-body">
                        {Body}
                        </span>
                        <small class="tumblr-date">{ShortMonth} {DayOfMonth} {Year}</small>
                    </span>
                {/block:Text}

                {block:Photo}
                    <span class="photo">
                        <img src="{PhotoURL-HighRes}" alt="{PhotoAlt}"/>
                        <span class="tumblr-permalink" style="display:none">{PhotoURL-HighRes}</span>

                        {block:Caption}
                            <div class="caption tumblr-body">{Caption}</div>
                        {/block:Caption}
                        <small class="tumblr-date">{ShortMonth} {DayOfMonth} {Year}</small>
                    </span>
                {/block:Photo}

                {block:Photoset}
                    <span class="photoset">
                        {Photoset-500}

                        {block:Caption}
                            <div class="caption">{Caption}</div>
                        {/block:Caption}
                        <small class="tumblr-date">{ShortMonth} {DayOfMonth} {Year}</small>
                    </span>
                {/block:Photoset}

                {block:Quote}
                    <span class="quote">
                        "{Quote}"

                        {block:Source}
                            <div class="source">{Source}</div>
                        {/block:Source}
                        <small class="tumblr-date">{ShortMonth} {DayOfMonth} {Year}</small>
                    </span>
                {/block:Quote}

                {block:Link}
                    <span class="link">
                        <a href="{URL}" class="link" {Target}>{Name}</a>

                        {block:Description}
                            <div class="description">{Description}</div>
                        {/block:Description}
                        <small class="tumblr-date">{ShortMonth} {DayOfMonth} {Year}</small>
                    </span>
                {/block:Link}

                {block:Chat}
                    <span class="chat">
                        {block:Title}
                            <h3><a href="{Permalink}">{Title}</a></h3>
                        {/block:Title}

                        <ul class="chat">
                            {block:Lines}
                                <li class="{Alt} user_{UserNumber}">
                                    {block:Label}
                                        <span class="label">{Label}</span>
                                    {/block:Label}

                                    {Line}
                                </li>
                            {/block:Lines}
                        </ul>
                        <small class="tumblr-date">{ShortMonth} {DayOfMonth} {Year}</small>
                    </span>
                {/block:Chat}

                {block:Video}
                    <span class="video">
                        {Video-500}

                        {block:Caption}
                            <div class="caption">{Caption}</div>
                        {/block:Caption}
                        <small class="tumblr-date">{ShortMonth} {DayOfMonth} {Year}</small>
                    </span>
                {/block:Video}

                {block:Audio}
                    <span class="audio">
                        {AudioPlayerBlack}

                        {block:Caption}
                            <div class="caption">{Caption}</div>
                        {/block:Caption}
                        <small class="tumblr-date">{ShortMonth} {DayOfMonth} {Year}</small>
                    </span>
                {/block:Audio}
            {/block:Posts}
  </div><!-- /tumblr-data -->
    </div><!-- /row -->
  </div><!-- /main content container -->
  <div style="clear:both;"></div>
  <div class="container"><!-- footer -->
    <div class="row">
    <div id="footerwrap" class="span16">
      <div id="footer">
        <p>&copy; 2012 <a href="http://pseudocodice.com/">Pseudo Codice</a>.</p>
        <div class="bioinfo">
          <dl>
            <dt>Organization</dt>
            <dd><a href="http://www.bioversityinternational.org/">Bioversity International</a></dd>
            <dt>Last Edited</dt>
            <dd>January 5, 2012</dd>
          </dl>
        </div>
      </div>
    </div>
  </div><!-- /footer -->

</body>
</html>
